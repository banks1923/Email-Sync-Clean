flowchart LR
    subgraph "Input Sources"
        GmailAPI[Gmail API<br/>Email Records]
        PDFFiles[PDF Files<br/>Document Chunks]
        Uploads[Direct Uploads<br/>User Files]
    end
    
    subgraph "Processing Layer"
        GmailService[Gmail Service<br/>extract_email_entities]
        PDFService[PDF Service<br/>OCR + Text Extract]
        UploadProcessor[Upload Processor]
    end
    
    subgraph "Unified Storage"
        ContentUnified[(content_unified<br/>Unified Content<br/>⚠️ Verify Status)]
        
        Columns[["Columns:<br/>id (INTEGER)<br/>source_type<br/>body<br/>title<br/>ready_for_embedding"]]
    end
    
    subgraph "AI Processing"
        EntityExtract[Entity Extraction<br/>SpaCy NER]
        Summarization[Summarization<br/>TF-IDF + TextRank]
        EmbeddingGen[Embedding Generation<br/>Legal BERT 1024D]
    end
    
    subgraph "Vector Storage"
        Qdrant[(Qdrant<br/>Vector Database<br/>Semantic Search)]
    end
    
    subgraph "Search & Intelligence"
        HybridSearch[Hybrid Search<br/>Keyword + Semantic]
        DuplicateDetect[Duplicate Detection]
        SimilarityAnalysis[Similarity Analysis]
        TopicClustering[Topic Clustering]
    end
    
    %% Data Flow
    GmailAPI --> GmailService
    PDFFiles --> PDFService
    Uploads --> UploadProcessor
    
    GmailService --> ContentUnified
    PDFService --> ContentUnified
    UploadProcessor --> ContentUnified
    
    ContentUnified --> EntityExtract
    ContentUnified --> Summarization
    ContentUnified --> EmbeddingGen
    
    EmbeddingGen --> Qdrant
    
    ContentUnified --> HybridSearch
    Qdrant --> HybridSearch
    
    ContentUnified --> DuplicateDetect
    ContentUnified --> SimilarityAnalysis
    ContentUnified --> TopicClustering
    
    SimilarityAnalysis --> Qdrant
    TopicClustering --> Qdrant
    
    style ContentUnified fill:#ffd700,stroke:#333,stroke-width:4px
    style Qdrant fill:#9370db
    style EmbeddingGen fill:#90ee90