graph TB
    subgraph "Root Level Services (Business Logic)"
        subgraph "Core Services"
            gmail[gmail/<br/>ğŸ“§ Email Processing<br/>OAuth, API calls<br/>1,883 lines]
            pdf[pdf/<br/>ğŸ“„ PDF Processing<br/>OCR, Text extraction<br/>3,523 lines]
            entity[entity/<br/>ğŸ·ï¸ Entity Extraction<br/>Legal BERT NER<br/>2,661 lines]
            search[search_intelligence/<br/>ğŸ” Search & Analysis<br/>Hybrid search<br/>1,797 lines]
            legal[legal_intelligence/<br/>âš–ï¸ Legal Analysis<br/>Case processing<br/>837 lines]
            summarize[summarization/<br/>ğŸ“ Document Summary<br/>TF-IDF + TextRank<br/>499 lines]
        end
        
        subgraph "Data & Knowledge"
            kg[knowledge_graph/<br/>ğŸ•¸ï¸ Knowledge Graph<br/>Entity relationships<br/>2,839 lines]
            shared[shared/<br/>ğŸ”— Shared Utilities<br/>SimpleDB, Utils<br/>6,123 lines]
        end
    end
    
    subgraph "Organized Utility Services"
        subgraph "utilities/"
            embeddings[embeddings/<br/>ğŸ¤– Legal BERT<br/>Embedding service<br/>157 lines]
            vector[vector_store/<br/>ğŸ“¡ Qdrant Client<br/>Vector operations<br/>413 lines]
            timeline[timeline/<br/>ğŸ“… Event Timeline<br/>Temporal analysis<br/>399 lines]
        end
    end
    
    subgraph "Infrastructure Services"
        subgraph "infrastructure/"
            docs[documents/<br/>ğŸ“‹ Document Pipeline<br/>Processing workflows<br/>1,993 lines]
            mcp[mcp_servers/<br/>ğŸ”Œ MCP Integration<br/>Claude Desktop tools<br/>1,589 lines]
            pipelines[pipelines/<br/>ğŸ¯ Service Orchestration<br/>Coordination logic<br/>N/A lines]
        end
    end
    
    subgraph "Development Tools"
        subgraph "tools/"
            cli[cli/<br/>ğŸ› ï¸ CLI Handlers<br/>Command processing]
            scripts[scripts/<br/>ğŸ“œ User Scripts<br/>vsearch, diagnostics]
        end
    end
    
    subgraph "Email Processing v2.0"
        subgraph "email_parsing/"
            dedup[message_deduplicator.py<br/>ğŸ†• Advanced Parser<br/>Message-level dedup<br/>97% test coverage]
            boundary[Boundary Detection<br/>Reply/forward parsing]
            hash[Content Hashing<br/>SHA256 deduplication]
        end
    end
    
    subgraph "Data Storage"
        subgraph "data/"
            systemdata[system_data/<br/>ğŸ—„ï¸ System Files<br/>Database, cache, backups]
            userdata[Stoneman_dispute/user_data/<br/>ğŸ“ Case Documents<br/>100+ legal files]
            backups[system_data/backups/<br/>ğŸ’¾ Database Backups<br/>Automated snapshots]
        end
    end
    
    subgraph "External Dependencies"
        qdrant[(Qdrant Vector DB<br/>localhost:6333<br/>1024D vectors)]
        legalbert[(Legal BERT Model<br/>pile-of-law/legalbert<br/>Hugging Face)]
        claude[(Claude Desktop<br/>MCP Integration<br/>12+ tools)]
    end
    
    %% Service Dependencies
    gmail --> shared
    pdf --> shared
    entity --> shared
    search --> shared
    legal --> shared
    summarize --> shared
    kg --> shared
    
    %% Utility Dependencies
    embeddings --> legalbert
    vector --> qdrant
    timeline --> shared
    
    %% Infrastructure Dependencies
    docs --> pdf
    mcp --> search
    mcp --> legal
    mcp --> claude
    pipelines --> embeddings
    pipelines --> vector
    
    %% Email Processing Dependencies
    dedup --> shared
    dedup --> systemdata
    boundary --> dedup
    hash --> dedup
    
    %% Tool Dependencies
    cli --> search
    cli --> legal
    scripts --> vector
    scripts --> qdrant
    
    %% Data Flow
    gmail --> systemdata
    pdf --> systemdata
    entity --> systemdata
    dedup --> systemdata
    
    systemdata --> backups
    userdata --> pdf
    
    %% Architecture Stats
    classDef coreService fill:#3498db,stroke:#2c3e50,stroke-width:2px,color:#fff
    classDef utilityService fill:#2ecc71,stroke:#27ae60,stroke-width:2px,color:#fff  
    classDef infraService fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#fff
    classDef dataService fill:#f39c12,stroke:#d35400,stroke-width:2px,color:#fff
    classDef externalService fill:#9b59b6,stroke:#8e44ad,stroke-width:2px,color:#fff
    classDef newService fill:#1abc9c,stroke:#16a085,stroke-width:3px,color:#fff
    
    class gmail,pdf,entity,search,legal,summarize,kg coreService
    class embeddings,vector,timeline utilityService
    class docs,mcp,pipelines,cli,scripts infraService
    class shared,systemdata,userdata,backups dataService
    class qdrant,legalbert,claude externalService
    class dedup,boundary,hash newService